--Q1 GET ALL CITIZENS DETAILS WHO LIVE IN CHENNAI
SELECT * FROM CITIZENS
WHERE ADDRESS LIKE'%Chennai%';

--Q2 SHOW CITIZEN NAMES WITH THEIR HOUSEHOLD WARD NUMBERS
SELECT 
CITIZENS.FULLNAME, HOUSEHOLDS.WARDNUMBER
FROM CITIZENS
JOIN HOUSEHOLDS
ON CITIZENS.CITIZENID = HOUSEHOLDS.OWNERCITIZENID;
	
--Q3 LIST ALL ACTIVE SMART METERS WITH THE OWNERS NAME
SELECT CITIZENS.FULLNAME, SMARTMETERS.METERTYPE, SMARTMETERS.STATUS
FROM SMARTMETERS
JOIN HOUSEHOLDS
ON SMARTMETERS.HOUSEHOLDID = HOUSEHOLDS.HOUSEHOLDID
JOIN CITIZENS
ON HOUSEHOLDS.OWNERCITIZENID = CITIZENS.CITIZENID
WHERE SMARTMETERS.STATUS = 'ACTIVE';

--Q4 LIST THE HOUSEHOLDID WHERE USAGE IS MORE THAN 300 LITTRES 
SELECT HOUSEHOLDID, WATERLITRES
FROM ENERGYUSAGE
WHERE WATERLITRES > 300;

--Q5 FIND CITIZENS WHO REQUESTED AN AMBULANCE 
SELECT CITIZENS.FULLNAME, EMERGENCYREQUESTS.REQUESTID, EMERGENCYSERVICES.SERVICETYPE
FROM EMERGENCYREQUESTS
JOIN CITIZENS
ON EMERGENCYREQUESTS.CITIZENID = CITIZENS.CITIZENID
JOIN EMERGENCYSERVICES
ON EMERGENCYSERVICES.SERVICEID = EMERGENCYREQUESTS.SERVICEID
WHERE EMERGENCYSERVICES.SERVICETYPE = 'AMBULANCE';

--Q6 FIND TOTAL REVENUE GENERATED BY EACHING PARKING LOT
SELECT PARKINGLOTS.LOCATION,
SUM(PARKINGTRANSACTIONS.CHARGESPAID) AS TOTALREVENUE
FROM PARKINGTRANSACTIONS
JOIN PARKINGLOTS
ON PARKINGTRANSACTIONS.PARKINGID = PARKINGLOTS.PARKINGID
GROUP BY 
PARKINGLOTS.LOCATION;

--Q7 DISPLAY HOUSEHOLDS ALONG WITH THEIR OWNERSNAME AND NUMBER OF RESIDENTS
SELECT CITIZENS.FULLNAME, HOUSEHOLDS.ADDRESS, HOUSEHOLDS.NUMBEROFRESIDENTS
FROM CITIZENS
JOIN HOUSEHOLDS
ON CITIZENS.CITIZENID = HOUSEHOLDS.OWNERCITIZENID;

--Q8 SHOW ALL INACTIVE SMARTMETERS WITH HOUSEHOLD ADDRESSES
SELECT 
SMARTMETERS.METERID,
SMARTMETERS.METERTYPE,
SMARTMETERS.STATUS,
HOUSEHOLDS.ADDRESS
FROM SMARTMETERS
JOIN HOUSEHOLDS
ON SMARTMETERS.HOUSEHOLDID = HOUSEHOLDS.HOUSEHOLDID
WHERE SMARTMETERS.STATUS = 'INACTIVE';

--Q9 FIND THE MAXIMUM ELECTRICITY AMONG ALL HOUSEHOLDS
SELECT
MAX(ENERGYUSAGE.ELECTRICITYUNITS) AS MAXIMUMUSED
FROM ENERGYUSAGE
--
SELECT                                                                        
ENERGYUSAGE.HOUSEHOLDID,
MAX(ENERGYUSAGE.ELECTRICITYUNITS) AS MAXIMUMUSED
FROM ENERGYUSAGE
GROUP BY ENERGYUSAGE.HOUSEHOLDID;

--Q10 GET HOUSEHOLDS WHOSE GAS USAGE IS 3 UNITS OR MORE
SELECT
ENERGYUSAGE.HOUSEHOLDID,
ENERGYUSAGE.RECORDID,
ENERGYUSAGE.GASUNITS
FROM ENERGYUSAGE
WHERE ENERGYUSAGE.GASUNITS >= 3;

--Q11 GET CITIZENS WHO LIVE IN APPARTMENTS
SELECT
CITIZENS.FULLNAME,
HOUSEHOLDS.PROPERTYTYPE
FROM CITIZENS
JOIN HOUSEHOLDS
ON CITIZENS.CITIZENID = HOUSEHOLDS.OWNERCITIZENID
WHERE HOUSEHOLDS.PROPERTYTYPE = 'APARTMENT';

--Q12 GET THE LIST OF THE CITIZENS WHO MADE MORE THAN ONE REQUEST
SELECT * FROM CITIZENS 
WHERE CITIZENID IN (
SELECT CITIZENID
FROM EMERGENCYREQUESTS
GROUP BY CITIZENID
HAVING COUNT(REQUESTID) > 1
);

--Q13 FIND THE CITIZEN WHO MADE THE FIRST EMERGENCY REQUEST EVER
SELECT * FROM CITIZENS
WHERE CITIZENID = (
SELECT EMERGENCYREQUESTS.CITIZENID
FROM EMERGENCYREQUESTS
ORDER BY EMERGENCYREQUESTS.REQUESTTIME ASC
LIMIT 1
);

14 GET THE FULL DETAILS OF HOUSEHOLDS WHERE THE OWNER IS A FEMALE CITIZEN
SELECT *
FROM HOUSEHOLDS
WHERE OWNERCITIZENID IN (
SELECT CITIZENID
FROM CITIZENS
WHERE GENDER = 'FEMALE'
);

15 DISPLAY THE HOUSEHOLD ADDRESS AND WARDNUMBER FOR HOUSEHOLDS THAT HAVE ENERGY USAGE GREATER THAN THE AVERAGE ELECTRICITY UNITS OF ALL HOUSEHOLDS
SELECT ADDRESS, WARDNUMBER
FROM HOUSEHOLDS
WHERE HOUSEHOLDID IN (
SELECT HOUSEHOLDID
FROM ENERGYUSAGE
WHERE ELECTRICITYUNITS >
(SELECT AVG(ELECTRICITYUNITS) FROM ENERGYUSAGE)
);

16 SHOW DETAILS OF SMARTMETERS INSTALLED AFTER THE FIRST INSTALLATION DATE RECORDED IN THE SYSTEM
SELECT *
FROM SMARTMETERS
WHERE INSTALLATIONDATE >
(SELECT MIN(INSTALLATIONDATE)
FROM SMARTMETERS);

17 GET CITIZENS WHO LIVE IN A LOCATION WHERE PARKING CAPACITY IS MORE THAN 300
SELECT *
FROM CITIZENS
WHERE ADDRESS LIKE CONCAT('%',
(SELECT LOCATION
FROM PARKINGLOTS
WHERE CAPACITY > 300
LIMIT 1),
'%');

18 LIST ALL EMERGENCY REQUESTS WHERE THE RESPONSE TIME IS GREATER THAN THE AVERAGE RESPONSE TIME OF ALL REQUESTS
SELECT *
FROM EMERGENCYREQUESTS
WHERE TIMESTAMPDIFF(MINUTE, REQUESTTIME, RESPONSETIME) >
(
SELECT AVG(TIMESTAMPDIFF(MINUTE, REQUESTTIME, RESPONSETIME))
FROM EMERGENCYREQUESTS
);

19 SHOW ALL CITIZENS WHO OWN A HOUSEHOLD WHERE THE NUMBER OF RESIDENTS IS ABOVE THE OVERALL AVERAGE
SELECT *
FROM CITIZENS
WHERE CITIZENID IN (
SELECT OWNERCITIZENID
FROM HOUSEHOLDS
WHERE NUMBEROFRESIDENTS >
(SELECT AVG(NUMBEROFRESIDENTS)
FROM HOUSEHOLDS)
);

20 GET THE DETAILS OF PARKING LOTS THAT HAVE MORE AVAILABLE SLOTS THAN THE AVERAGE AVAILABLE SLOTS
SELECT *
FROM PARKINGLOTS
WHERE AVAILABLESLOTS >
(
SELECT AVG(AVAILABLESLOTS)
FROM PARKINGLOTS
);

21 GET THE DETAILS OF HOUSEHOLDS THAT HAVE NEVER RECORDED ANY ENERGY USAGE
SELECT *
FROM HOUSEHOLDS
WHERE HOUSEHOLDID NOT IN (
SELECT HOUSEHOLDID
FROM ENERGYUSAGE
);

22 SHOW PARKING TRANSACTIONS WHERE THE AMOUNT PAID IS HIGHER THAN THE AVERAGE AMOUNT PAID IN THE SAME PARKING LOT
SELECT *
FROM PARKINGTRANSACTIONS PT
WHERE PT.CHARGESPAID >
(
SELECT AVG(CHARGESPAID)
FROM PARKINGTRANSACTIONS
WHERE PARKINGID = PT.PARKINGID
);

23 DISPLAY DETAILS OF EMERGENCY SERVICES THAT RECEIVED REQUESTS WITH HIGHER SEVERITY THAN THE LOWEST SEVERITY RECORDED.PLAY DETAILS OF EMERGENCY SERVICES THAT RECEIVED REQUESTS WITH HIGHER SEVERITY THAN THE LOWEST SEVERITY RECORDED.
SELECT *
FROM EMERGENCYSERVICES
WHERE SERVICEID IN (
SELECT SERVICEID
FROM EMERGENCYREQUESTS
WHERE SEVERITYLEVEL >
(SELECT MIN(SEVERITYLEVEL)
FROM EMERGENCYREQUESTS)
);

24 GET THE DETAILS OF CITIZENS WHO LIVE IN THE SAME WARDNUMBER AS THE HOUSEHOLD OWNED BY CITIZEN WITH CITIZENID
SELECT *
FROM CITIZENS
WHERE ADDRESS LIKE CONCAT('%',
(SELECT ADDRESS
FROM HOUSEHOLDS
WHERE OWNERCITIZENID = 101),
'%');

25 SHOW THE DETAILS OF SMARTMETERS THAT BELONG TO THE SAME HOUSEHOLD AS THE METER WITH METERID
SELECT *
FROM SMARTMETERS
WHERE HOUSEHOLDID =
(SELECT HOUSEHOLDID
FROM SMARTMETERS
WHERE METERID = 11);


